<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Multivariate analysis and dimension reduction | Data exploration and statistics with R and the tidyverse</title>
  <meta name="description" content="Welcome to the wonderful world of data science and R !" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Multivariate analysis and dimension reduction | Data exploration and statistics with R and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Welcome to the wonderful world of data science and R !" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Multivariate analysis and dimension reduction | Data exploration and statistics with R and the tidyverse" />
  
  <meta name="twitter:description" content="Welcome to the wonderful world of data science and R !" />
  

<meta name="author" content="Vivien Roussez (GoStudent)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="stats.html"/>
<link rel="next" href="reg.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data exploration and statistics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Foreword</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#topics-of-the-week"><i class="fa fa-check"></i><b>2.1</b> Topics of the week</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#the-data-science-workflow"><i class="fa fa-check"></i><b>2.2</b> The data science workflow</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#about-the-interactions-with-other-colleagues"><i class="fa fa-check"></i><b>2.3</b> About the interactions with other colleagues</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#resources"><i class="fa fa-check"></i><b>2.4</b> Resources</a></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#data-of-the-week"><i class="fa fa-check"></i><b>2.5</b> Data of the week</a></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#your-mission"><i class="fa fa-check"></i><b>2.6</b> Your mission</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro_r.html"><a href="intro_r.html"><i class="fa fa-check"></i><b>3</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="intro_r.html"><a href="intro_r.html#what-is-r"><i class="fa fa-check"></i><b>3.1</b> What is R</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="intro_r.html"><a href="intro_r.html#description"><i class="fa fa-check"></i><b>3.1.1</b> Description</a></li>
<li class="chapter" data-level="3.1.2" data-path="intro_r.html"><a href="intro_r.html#objective-comparison-with-pyhton"><i class="fa fa-check"></i><b>3.1.2</b> (Objective) comparison with Pyhton</a></li>
<li class="chapter" data-level="3.1.3" data-path="intro_r.html"><a href="intro_r.html#what-can-i-do-with-r"><i class="fa fa-check"></i><b>3.1.3</b> What can I do with R</a></li>
<li class="chapter" data-level="3.1.4" data-path="intro_r.html"><a href="intro_r.html#quick-presentation-of-the-ecosystem"><i class="fa fa-check"></i><b>3.1.4</b> Quick presentation of the ecosystem</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="intro_r.html"><a href="intro_r.html#basic-commands-to-know"><i class="fa fa-check"></i><b>3.2</b> Basic commands to know</a></li>
<li class="chapter" data-level="3.3" data-path="intro_r.html"><a href="intro_r.html#data-structures-in-r"><i class="fa fa-check"></i><b>3.3</b> Data structures in R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="intro_r.html"><a href="intro_r.html#basic-data-structures"><i class="fa fa-check"></i><b>3.3.1</b> Basic data structures</a></li>
<li class="chapter" data-level="3.3.2" data-path="intro_r.html"><a href="intro_r.html#explore-a-new-data-structure-or-object"><i class="fa fa-check"></i><b>3.3.2</b> Explore a new data structure (or object)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manip.html"><a href="manip.html"><i class="fa fa-check"></i><b>4</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="manip.html"><a href="manip.html#import"><i class="fa fa-check"></i><b>4.1</b> Import</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="manip.html"><a href="manip.html#text-files"><i class="fa fa-check"></i><b>4.1.1</b> Text files</a></li>
<li class="chapter" data-level="4.1.2" data-path="manip.html"><a href="manip.html#excel-files"><i class="fa fa-check"></i><b>4.1.2</b> Excel files</a></li>
<li class="chapter" data-level="4.1.3" data-path="manip.html"><a href="manip.html#more-formats"><i class="fa fa-check"></i><b>4.1.3</b> More formats</a></li>
<li class="chapter" data-level="4.1.4" data-path="manip.html"><a href="manip.html#read-from-databases-big-data"><i class="fa fa-check"></i><b>4.1.4</b> Read from databases / big data</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="manip.html"><a href="manip.html#the-grammar-of-data-manipulation"><i class="fa fa-check"></i><b>4.2</b> The grammar of data manipulation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="manip.html"><a href="manip.html#the-pipe"><i class="fa fa-check"></i><b>4.2.1</b> The pipe</a></li>
<li class="chapter" data-level="4.2.2" data-path="manip.html"><a href="manip.html#the-verbs-of-manipulation"><i class="fa fa-check"></i><b>4.2.2</b> The verbs of manipulation</a></li>
<li class="chapter" data-level="4.2.3" data-path="manip.html"><a href="manip.html#filter-conditions"><i class="fa fa-check"></i><b>4.2.3</b> Filter : conditions</a></li>
<li class="chapter" data-level="4.2.4" data-path="manip.html"><a href="manip.html#mutate"><i class="fa fa-check"></i><b>4.2.4</b> Mutate</a></li>
<li class="chapter" data-level="4.2.5" data-path="manip.html"><a href="manip.html#summarize"><i class="fa fa-check"></i><b>4.2.5</b> Summarize</a></li>
<li class="chapter" data-level="4.2.6" data-path="manip.html"><a href="manip.html#join-with-other-tables"><i class="fa fa-check"></i><b>4.2.6</b> Join with other tables</a></li>
<li class="chapter" data-level="4.2.7" data-path="manip.html"><a href="manip.html#manipulate-several-data-in-the-same-time"><i class="fa fa-check"></i><b>4.2.7</b> Manipulate several data in the same time</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="manip.html"><a href="manip.html#lets-import-and-wrangle-some-data"><i class="fa fa-check"></i><b>4.3</b> Let’s import and wrangle some data !</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="manip.html"><a href="manip.html#the-data"><i class="fa fa-check"></i><b>4.3.1</b> The data</a></li>
<li class="chapter" data-level="4.3.2" data-path="manip.html"><a href="manip.html#one-tool-you-will-need-lapply"><i class="fa fa-check"></i><b>4.3.2</b> One tool you will need : <code>lapply()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="manip.html"><a href="manip.html#tidy-your-data"><i class="fa fa-check"></i><b>4.4</b> Tidy your data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="stats.html"><a href="stats.html"><i class="fa fa-check"></i><b>5</b> Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="stats.html"><a href="stats.html#definitions"><i class="fa fa-check"></i><b>5.1</b> Definitions</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="stats.html"><a href="stats.html#terminology"><i class="fa fa-check"></i><b>5.1.1</b> Terminology</a></li>
<li class="chapter" data-level="5.1.2" data-path="stats.html"><a href="stats.html#types-of-variables"><i class="fa fa-check"></i><b>5.1.2</b> Types of variables</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="stats.html"><a href="stats.html#univariate-statistics"><i class="fa fa-check"></i><b>5.2</b> Univariate statistics</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="stats.html"><a href="stats.html#numerical-variables"><i class="fa fa-check"></i><b>5.2.1</b> Numerical variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="stats.html"><a href="stats.html#categorical-variables"><i class="fa fa-check"></i><b>5.2.2</b> Categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="stats.html"><a href="stats.html#bivariate-statistics"><i class="fa fa-check"></i><b>5.3</b> Bivariate statistics</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="stats.html"><a href="stats.html#continuous-variables"><i class="fa fa-check"></i><b>5.3.1</b> 2 continuous variables</a></li>
<li class="chapter" data-level="5.3.2" data-path="stats.html"><a href="stats.html#categorical-variables-1"><i class="fa fa-check"></i><b>5.3.2</b> 2 categorical variables</a></li>
<li class="chapter" data-level="5.3.3" data-path="stats.html"><a href="stats.html#continuous-1-categorical-variable"><i class="fa fa-check"></i><b>5.3.3</b> 1 continuous, 1 categorical variable</a></li>
<li class="chapter" data-level="5.3.4" data-path="stats.html"><a href="stats.html#exercises-1"><i class="fa fa-check"></i><b>5.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="stats.html"><a href="stats.html#stat_inf"><i class="fa fa-check"></i><b>5.4</b> Statistical inference</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="stats.html"><a href="stats.html#the-statistical-model"><i class="fa fa-check"></i><b>5.4.1</b> The statistical model</a></li>
<li class="chapter" data-level="5.4.2" data-path="stats.html"><a href="stats.html#two-fundamental-theorems"><i class="fa fa-check"></i><b>5.4.2</b> Two fundamental theorems</a></li>
<li class="chapter" data-level="5.4.3" data-path="stats.html"><a href="stats.html#statistical-tests"><i class="fa fa-check"></i><b>5.4.3</b> Statistical tests</a></li>
<li class="chapter" data-level="5.4.4" data-path="stats.html"><a href="stats.html#other-estimators-maximum-of-likelihood"><i class="fa fa-check"></i><b>5.4.4</b> Other estimators : maximum of likelihood</a></li>
<li class="chapter" data-level="5.4.5" data-path="stats.html"><a href="stats.html#exercises-interprete-a-test-you-dont-know"><i class="fa fa-check"></i><b>5.4.5</b> Exercises : interprete a test you don’t know</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivar.html"><a href="multivar.html"><i class="fa fa-check"></i><b>6</b> Multivariate analysis and dimension reduction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multivar.html"><a href="multivar.html#multivariate-analysis"><i class="fa fa-check"></i><b>6.1</b> Multivariate analysis</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="multivar.html"><a href="multivar.html#advanced-visualization"><i class="fa fa-check"></i><b>6.1.1</b> Advanced visualization</a></li>
<li class="chapter" data-level="6.1.2" data-path="multivar.html"><a href="multivar.html#easily-explore-an-entire-dataset"><i class="fa fa-check"></i><b>6.1.2</b> Easily explore an entire dataset</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="multivar.html"><a href="multivar.html#multivariate-analysis-and-dimension-reduction"><i class="fa fa-check"></i><b>6.2</b> Multivariate analysis and dimension reduction</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="multivar.html"><a href="multivar.html#imputation"><i class="fa fa-check"></i><b>6.2.1</b> Imputation</a></li>
<li class="chapter" data-level="6.2.2" data-path="multivar.html"><a href="multivar.html#normalization"><i class="fa fa-check"></i><b>6.2.2</b> Normalization</a></li>
<li class="chapter" data-level="6.2.3" data-path="multivar.html"><a href="multivar.html#pca"><i class="fa fa-check"></i><b>6.2.3</b> PCA</a></li>
<li class="chapter" data-level="6.2.4" data-path="multivar.html"><a href="multivar.html#exercises-2"><i class="fa fa-check"></i><b>6.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="multivar.html"><a href="multivar.html#dimension-reduction"><i class="fa fa-check"></i><b>6.3</b> Dimension reduction</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="multivar.html"><a href="multivar.html#use-the-results-of-the-pca"><i class="fa fa-check"></i><b>6.3.1</b> Use the results of the PCA</a></li>
<li class="chapter" data-level="6.3.2" data-path="multivar.html"><a href="multivar.html#other-inertia-based-methods"><i class="fa fa-check"></i><b>6.3.2</b> Other inertia-based methods</a></li>
<li class="chapter" data-level="6.3.3" data-path="multivar.html"><a href="multivar.html#t-sne"><i class="fa fa-check"></i><b>6.3.3</b> t-SNE</a></li>
<li class="chapter" data-level="6.3.4" data-path="multivar.html"><a href="multivar.html#a-word-about-clustering"><i class="fa fa-check"></i><b>6.3.4</b> A word about clustering</a></li>
<li class="chapter" data-level="6.3.5" data-path="multivar.html"><a href="multivar.html#exercise-1"><i class="fa fa-check"></i><b>6.3.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="multivar.html"><a href="multivar.html#visualization-bonus-dashboards-and-reports"><i class="fa fa-check"></i><b>6.4</b> Visualization bonus : dashboards and reports</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="multivar.html"><a href="multivar.html#shiny-and-rmarkdown"><i class="fa fa-check"></i><b>6.4.1</b> Shiny and rmarkdown</a></li>
<li class="chapter" data-level="6.4.2" data-path="multivar.html"><a href="multivar.html#web-based-graphics-with-plotly"><i class="fa fa-check"></i><b>6.4.2</b> Web-based graphics with <code>plotly</code></a></li>
<li class="chapter" data-level="6.4.3" data-path="multivar.html"><a href="multivar.html#other-packages-widgets"><i class="fa fa-check"></i><b>6.4.3</b> Other packages &amp; widgets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reg.html"><a href="reg.html"><i class="fa fa-check"></i><b>7</b> Linear and logistic regression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="reg.html"><a href="reg.html#linear-regression"><i class="fa fa-check"></i><b>7.1</b> Linear regression</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="reg.html"><a href="reg.html#general-presentation"><i class="fa fa-check"></i><b>7.1.1</b> General presentation</a></li>
<li class="chapter" data-level="7.1.2" data-path="reg.html"><a href="reg.html#implementation-and-diagnostics"><i class="fa fa-check"></i><b>7.1.2</b> Implementation and diagnostics</a></li>
<li class="chapter" data-level="7.1.3" data-path="reg.html"><a href="reg.html#coefficients-interpretation-and-inference"><i class="fa fa-check"></i><b>7.1.3</b> Coefficients interpretation and inference</a></li>
<li class="chapter" data-level="7.1.4" data-path="reg.html"><a href="reg.html#the-frischwaugh-theorem-and-the-omitted-variable-bias"><i class="fa fa-check"></i><b>7.1.4</b> The Frisch–Waugh Theorem and the omitted variable bias</a></li>
<li class="chapter" data-level="7.1.5" data-path="reg.html"><a href="reg.html#feature-engineering-and-functional-specification"><i class="fa fa-check"></i><b>7.1.5</b> Feature engineering and functional specification</a></li>
<li class="chapter" data-level="7.1.6" data-path="reg.html"><a href="reg.html#variable-selection"><i class="fa fa-check"></i><b>7.1.6</b> Variable selection</a></li>
<li class="chapter" data-level="7.1.7" data-path="reg.html"><a href="reg.html#exercises-3"><i class="fa fa-check"></i><b>7.1.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="reg.html"><a href="reg.html#logitic-regression"><i class="fa fa-check"></i><b>7.2</b> Logitic regression</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="reg.html"><a href="reg.html#mathematical-formulation"><i class="fa fa-check"></i><b>7.2.1</b> Mathematical formulation</a></li>
<li class="chapter" data-level="7.2.2" data-path="reg.html"><a href="reg.html#implementation-in-r-and-interpretation"><i class="fa fa-check"></i><b>7.2.2</b> Implementation in R and interpretation</a></li>
<li class="chapter" data-level="7.2.3" data-path="reg.html"><a href="reg.html#goodness-of-fit"><i class="fa fa-check"></i><b>7.2.3</b> Goodness of fit</a></li>
<li class="chapter" data-level="7.2.4" data-path="reg.html"><a href="reg.html#exercises-4"><i class="fa fa-check"></i><b>7.2.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data exploration and statistics with R and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multivar" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Multivariate analysis and dimension reduction</h1>
<div id="multivariate-analysis" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Multivariate analysis</h2>
<div id="advanced-visualization" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Advanced visualization</h3>
<div id="the-grammar-of-graphics" class="section level4" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> The grammar of graphics</h4>
<p>The grammar of graphics was introduced in 2005 by Wilkinson and Leland as a general framework for graphical representation of data. It was adapted by Hadley Wickham in the R package <code>ggplot2</code>.
<em>It presents a unique foundation for producing almost every quantitative graphic found in scientific journals, newspapers, statistical packages, and data visualization systems</em>.</p>
<p>You can check <a href="https://vita.had.co.nz/papers/layered-grammar.html">the paper</a> from Wickham</p>
<p>When ploting data, one has to define :</p>
<ul>
<li>What are the aesthetics <span class="math inline">\(\rightarrow\)</span> <strong>the dimensions you want to represent</strong></li>
<li>What is the geometry you want to use <span class="math inline">\(\rightarrow\)</span> <strong>the kind of plot you want</strong></li>
<li>Ploting options (that come with default values) :
<ul>
<li>scales of the axis</li>
<li>fonts and colors for text</li>
<li>labels (title, axis titles…)</li>
</ul></li>
</ul>
<p>In short, what you have to find is the right combination of aesthetics and geometry that best represent the data. To find the recommended combination, don’t forget to use <a href="https://www.data-to-viz.com/">From data to viz</a></p>
</div>
<div id="playing-with-aesthetics" class="section level4" number="6.1.1.2">
<h4><span class="header-section-number">6.1.1.2</span> Playing with aesthetics</h4>
<p>You must define at least 1 dimension for the plot, either continuous or categorical for the x axis. Then you can increase the number of dimensions (ie columns of the data frame) you want to represent :</p>
<ul>
<li>x and y for the axis</li>
<li>size : optional (integer) dimension that will represent an additional number</li>
<li>color/fill : optional (categorical) dimension reprensented by a color. Color is for line/point geoms, fill for bars/heatmap geoms</li>
<li>linetype : optional (categorical) : different type of lines (solid, dotted, dashed…). Only for geometries using lines</li>
<li>shape : optional (categorical) : variable that will make the shape of the dot vary. Only for point geometries</li>
<li>alpha : optional (continuous) : the transparency of the dots (the lower the value, the more transparent the dot)</li>
<li>…</li>
</ul>
<p>More about the aesthetics <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html">here</a></p>
<p>You can also use the <code>facet_wrap()</code> or <code>facet_grid()</code> functions to add up to 2 more dimensions with categorical variables (see demo)</p>
</div>
<div id="geometries" class="section level4" number="6.1.1.3">
<h4><span class="header-section-number">6.1.1.3</span> Geometries</h4>
<p>Once you chose the variables (dimensions) you want to plot, you have to chose the geometry, that highly depends on the type of variable (numerical or character/factor). Don’t forget to reffer to the website <em>from data to viz</em> if you need some inspiration.</p>
<p>A short list of most common geometries :</p>
<ul>
<li>geom_bar for barplots</li>
<li>geom_histogram for histograms</li>
<li>geom_jitter for scatter plots</li>
<li>geom_boxplot &amp; geom_violin for compared density plots</li>
<li>geom_tile for heatmaps</li>
<li>geom_line for time series</li>
<li>geom_text or geom_label for text (annotations)</li>
<li>geom_hline and geom_vline for horizontal and vertiacal lines</li>
<li>……</li>
</ul>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="multivar.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From </span></span>
<span id="cb210-2"><a href="multivar.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(<span class="at">x=</span>distance)) <span class="sc">+</span></span>
<span id="cb210-3"><a href="multivar.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="multivar.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(<span class="at">x=</span>distance)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb211-2"><a href="multivar.html#cb211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-74-2.png" width="672" /></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="multivar.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(distance,avgSpeed)) <span class="sc">+</span> <span class="fu">geom_jitter</span>()<span class="sc">+</span></span>
<span id="cb212-2"><a href="multivar.html#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-74-3.png" width="672" /></p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="multivar.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(distance,avgSpeed,<span class="at">color=</span>activity_recoded))  <span class="sc">+</span> </span>
<span id="cb213-2"><a href="multivar.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()<span class="sc">+</span></span>
<span id="cb213-3"><a href="multivar.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-74-4.png" width="672" /></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="multivar.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To </span></span>
<span id="cb214-2"><a href="multivar.html#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(<span class="at">x=</span>avgSpeed,<span class="at">y=</span>calories,<span class="at">size=</span>duration,</span>
<span id="cb214-3"><a href="multivar.html#cb214-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color=</span>qual_distance,<span class="at">shape=</span>qual_avgHr)) <span class="sc">+</span> </span>
<span id="cb214-4"><a href="multivar.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb214-5"><a href="multivar.html#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> activity_recoded,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb214-6"><a href="multivar.html#cb214-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-74-5.png" width="672" /></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="multivar.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or maybe</span></span>
<span id="cb215-2"><a href="multivar.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(<span class="at">x=</span>avgSpeed,<span class="at">y=</span>elevationGain,</span>
<span id="cb215-3"><a href="multivar.html#cb215-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size=</span>calories,<span class="at">color=</span>duration)) <span class="sc">+</span> </span>
<span id="cb215-4"><a href="multivar.html#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb215-5"><a href="multivar.html#cb215-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(activity_recoded<span class="sc">~</span>qual_distance,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span> )<span class="sc">+</span></span>
<span id="cb215-6"><a href="multivar.html#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-74-6.png" width="672" /></p>
</div>
<div id="important-options" class="section level4" number="6.1.1.4">
<h4><span class="header-section-number">6.1.1.4</span> Important options</h4>
<p>With ggplot, one can make publishable graphics that don’t need to be modified in another software. For that, the most useful functions are :</p>
<ul>
<li>scale_xx_yy : functions that allow you to tweak the axis’ scale, the colors used by either <code>color</code> or <code>fill</code> aesthetics (eg : <code>scale_color_manual()</code>) and other options.</li>
<li>labs : allows you to proper label title, axis’ titles, legend titles…</li>
<li>theme : allows you to tweak general parameters for the plot (font family, font size, margins, background colors…). You have several <code>theme_xx()</code> functions already defined with different default values for those parameters (eg <code>theme_minimal()</code> or <code>theme_void()</code>)</li>
<li>guides : allows you to modify the legend entries</li>
</ul>
<p>Whats you can also do is recode the levels of the factor variables to make them more understanble or reorder them if you want them to be displayed in a specific order. See <code>forcats::fct_recode()</code> and <code>forcats::fct_reorder()</code></p>
<p><strong>Hint :</strong> when working with strings, you can force a string to be split in 2 rows with <code>\n</code></p>
<p>Here is an example :</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="multivar.html#cb216-1" aria-hidden="true" tabindex="-1"></a>dat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb216-2"><a href="multivar.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>avgSpeed,<span class="at">y=</span>elevationGain,<span class="at">size=</span>calories,<span class="at">color=</span>duration,<span class="at">size=</span>distance)) <span class="sc">+</span> </span>
<span id="cb216-3"><a href="multivar.html#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb216-4"><a href="multivar.html#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(activity_recoded<span class="sc">~</span>qual_distance,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span> ) <span class="sc">+</span></span>
<span id="cb216-5"><a href="multivar.html#cb216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb216-6"><a href="multivar.html#cb216-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Great insights&quot;</span>,<span class="at">y=</span><span class="st">&quot;Total evelation&quot;</span>,<span class="at">x=</span><span class="st">&quot;Average speed&quot;</span>,</span>
<span id="cb216-7"><a href="multivar.html#cb216-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">color=</span><span class="st">&quot;Duration&quot;</span>,<span class="at">size=</span><span class="st">&quot;Total distance&quot;</span>) <span class="sc">+</span></span>
<span id="cb216-8"><a href="multivar.html#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_manual(values = c(&quot;magenta&quot;,&quot;orange&quot;)) + </span></span>
<span id="cb216-9"><a href="multivar.html#cb216-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb216-10"><a href="multivar.html#cb216-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb216-11"><a href="multivar.html#cb216-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>comma)<span class="sc">+</span></span>
<span id="cb216-12"><a href="multivar.html#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
</div>
<div id="some-tricks-with-ggplot" class="section level4" number="6.1.1.5">
<h4><span class="header-section-number">6.1.1.5</span> Some tricks with ggplot</h4>
<p>This approach (grammar of graphics) is very coherent but makes it sometimes difficult. For example, how can I represent the distribution of several variables (and not the distribution of one variable according to different sub-groups -meaning that there is a second dimension -) ?</p>
<div id="the-cheater-way" class="section level5" number="6.1.1.5.1">
<h5><span class="header-section-number">6.1.1.5.1</span> The cheater way</h5>
<p>You can brute-force the graph by superposing different geometries. But first, you’ll have to standardize the variables (they don’t have the same scale). Remember the usage of <code>across</code> to apply a function to a selection of variables.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="multivar.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(dat_clean,<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb217-2"><a href="multivar.html#cb217-2" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(xx) (xx<span class="sc">-</span><span class="fu">mean</span>(xx,<span class="at">na.rm=</span>T))<span class="sc">/</span><span class="fu">sd</span>(xx,<span class="at">na.rm=</span>T))) <span class="sc">%&gt;%</span> </span>
<span id="cb217-3"><a href="multivar.html#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="fu">aes</span>(distance),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb217-4"><a href="multivar.html#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(duration),<span class="at">color=</span><span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb217-5"><a href="multivar.html#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>This solution can be also used if you want to superpose different geometries (bars and lines, bars and hlines,…), and is in this case legal :D</p>
</div>
<div id="do-it-with-the-tidy-philosophy" class="section level5" number="6.1.1.5.2">
<h5><span class="header-section-number">6.1.1.5.2</span> Do it with the tidy philosophy</h5>
<p>You can reformulate this task as : I want to represent the distribution of one unique variable for 2 subgroups : distance and duration. I have to reshape the data first to create such a variable. For that I will use <code>tidyr::pivot_longer()</code> which helps me to transform columns into rows.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="multivar.html#cb218-1" aria-hidden="true" tabindex="-1"></a>reshaped <span class="ot">&lt;-</span> <span class="fu">select</span>(dat_clean,duration,distance) <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="multivar.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),<span class="at">names_to=</span><span class="st">&quot;latent_variable&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;values&quot;</span>)</span>
<span id="cb218-3"><a href="multivar.html#cb218-3" aria-hidden="true" tabindex="-1"></a>reshaped</span></code></pre></div>
<pre><code>## # A tibble: 11,600 × 2
##    latent_variable values
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 duration         71.2 
##  2 distance          3.4 
##  3 duration         37.9 
##  4 distance         27.7 
##  5 duration         28.4 
##  6 distance         16.4 
##  7 duration         70.4 
##  8 distance         15.0 
##  9 duration         10.4 
## 10 distance          6.24
## # … with 11,590 more rows</code></pre>
<p>Now I can use the latent_variable variable as a dimension in a classic ggplot statement, with a prior standardization</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="multivar.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(reshaped,latent_variable) <span class="sc">%&gt;%</span> </span>
<span id="cb220-2"><a href="multivar.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">values=</span>(values<span class="sc">-</span><span class="fu">mean</span>(values,<span class="at">na.rm =</span> T))<span class="sc">/</span><span class="fu">sd</span>(values,<span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="multivar.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(values,<span class="at">color=</span>latent_variable)) <span class="sc">+</span> <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb220-4"><a href="multivar.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>Or you can even skip the standardization step thanks to facets :</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="multivar.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(reshaped,<span class="fu">aes</span>(values)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb221-2"><a href="multivar.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>latent_variable,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb221-3"><a href="multivar.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
<div id="combine-different-plots-with-ggpubr" class="section level5" number="6.1.1.5.3">
<h5><span class="header-section-number">6.1.1.5.3</span> Combine different plots with ggpubr</h5>
<p><code>ggpubr</code> makes your life much easier to make publication-ready graphics. It allows you for example to combine several ggplot graphics in a grid, regardless of any latent dimension that facet_grid would require. For that you have to store the graphics and “replay” them in a defined grid generated by <code>ggarrange()</code></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="multivar.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;ggpubr&quot;)</span></span>
<span id="cb222-2"><a href="multivar.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggpubr)</span>
<span id="cb222-3"><a href="multivar.html#cb222-3" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(distance)) <span class="sc">+</span> <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb222-4"><a href="multivar.html#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distance distribution&quot;</span>)<span class="sc">+</span></span>
<span id="cb222-5"><a href="multivar.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb222-6"><a href="multivar.html#cb222-6" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_clean,<span class="fu">aes</span>(<span class="at">x=</span>avgSpeed,<span class="at">y=</span>elevationGain,</span>
<span id="cb222-7"><a href="multivar.html#cb222-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size=</span>calories,<span class="at">color=</span>duration,<span class="at">size=</span>distance)) <span class="sc">+</span> </span>
<span id="cb222-8"><a href="multivar.html#cb222-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb222-9"><a href="multivar.html#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(activity_recoded<span class="sc">~</span>qual_distance,<span class="at">scales =</span> <span class="st">&quot;free&quot;</span> ) <span class="sc">+</span></span>
<span id="cb222-10"><a href="multivar.html#cb222-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Beautiful but useless plot&quot;</span>)<span class="sc">+</span></span>
<span id="cb222-11"><a href="multivar.html#cb222-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb222-12"><a href="multivar.html#cb222-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-13"><a href="multivar.html#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(gg1,gg2,<span class="at">ncol =</span> <span class="dv">2</span>,<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-80-1.png" width="768" /></p>
<p>There are a lot of options in this function (common legend, height and width of each plot,…). You can check the full <a href="http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/">documentation of this package</a>.</p>
<p>Note that you can mix tables and graphics with this function. Tables can be rendered as ggplot object with <code>ggpubr::ggtexttable()</code></p>
</div>
</div>
</div>
<div id="easily-explore-an-entire-dataset" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Easily explore an entire dataset</h3>
<p>Now, you know how to produce one graph including several dimensions. To explore a new dataset and identify the correlations between them, you can visualize at a glance all variables in a datasets and their correlations with <code>GGally</code></p>
<div id="scatter-plot-matrix" class="section level4" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> Scatter plot matrix</h4>
<p>The scatter plot matrix shows the correlations between all variables and helps you to spot dependencies between them. We can use either the basic <code>plot()</code> function on the dataframe or the GGally package which provides nice extensions to ggplot.
Side note : the <code>ggpairs()</code> function does a lot of computation and can take a lot of time ! <span class="math inline">\(\rightarrow\)</span> if your dataset is large, you should run it only on a sample of the observations with <code>dplyr::sample_n()</code> or <code>dplyr::sample_frac()</code> or only on a selection of columns.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="multivar.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(dat_clean,distance,duration,avgHr,avgSpeed,avgPower,</span>
<span id="cb223-2"><a href="multivar.html#cb223-2" aria-hidden="true" tabindex="-1"></a>       calories,elevationGain,avgBikeCadence,activity_recoded) <span class="sc">%&gt;%</span> </span>
<span id="cb223-3"><a href="multivar.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="multivar.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;GGally&quot;)</span></span>
<span id="cb224-2"><a href="multivar.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(GGally)</span>
<span id="cb224-3"><a href="multivar.html#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(dat_clean,distance,duration,avgSpeed,</span>
<span id="cb224-4"><a href="multivar.html#cb224-4" aria-hidden="true" tabindex="-1"></a>       calories,activity_recoded) <span class="sc">%&gt;%</span> </span>
<span id="cb224-5"><a href="multivar.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-81-2.png" width="672" /></p>
</div>
<div id="correlation-plots" class="section level4" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> Correlation plots</h4>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="multivar.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(dat_clean,distance,duration,avgHr,avgSpeed,avgPower,</span>
<span id="cb225-2"><a href="multivar.html#cb225-2" aria-hidden="true" tabindex="-1"></a>       calories,elevationGain,avgDoubleCadence,activity_recoded)  <span class="sc">%&gt;%</span> </span>
<span id="cb225-3"><a href="multivar.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggcorr</span>(<span class="at">geom =</span> <span class="st">&quot;circle&quot;</span>)</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="multivariate-analysis-and-dimension-reduction" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Multivariate analysis and dimension reduction</h2>
<p>In this section, we will focus on the bike activities, which have the highest number of metrics. However, before we can go further, we have to deal with missing data and scale them to avoid that the column with a large order of magnitude are over-weighted.</p>
<div id="imputation" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Imputation</h3>
<p>So far, we have ignored the missing values because we were computing summary statistics on one or 2 variables. The problem when taking into account more columns is that the probability of having one missing value on one of these features is higher, and therefore the risk that the whole observation is ignored increases. Every observation should still contain some original information that an analysis (or a model) should reflect. To avoid to ignore to many observations because of missing data we perform <strong>imputation</strong>, meaning that we replace the missing value with a true value. Many methods can be used to that end :</p>
<p>For numeric variables</p>
<ul>
<li>Imputation with a random value from the sample</li>
<li>Imputation with the mean/median</li>
<li>Imputation with the nearest neighbours (k-nn)</li>
<li>Hotdeck</li>
<li>Imputation with a model (regression)</li>
</ul>
<p>For categorical variables :</p>
<ul>
<li>Imputation with random category selection</li>
<li>Imputation with the most frequent category (total or of the neighbours)</li>
<li>Hotdeck</li>
<li>Model-based imputation</li>
</ul>
<p>The challenge here is to chose between “reflecting the instance’s originality” or “not creating noise”</p>
<p>The following code counts the number of missing values per column and does a simple mean or median imputation. We will practice hte imputation via regression in the final chapter’s exercises.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="multivar.html#cb226-1" aria-hidden="true" tabindex="-1"></a>dat_bike <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat_clean,is_bike) <span class="co"># Bike activities</span></span>
<span id="cb226-2"><a href="multivar.html#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(dat_bike,<span class="cf">function</span>(xx) <span class="fu">sum</span>(<span class="fu">is.na</span>(xx)))</span></code></pre></div>
<pre><code>##                     activityId                        uuidMsb                        uuidLsb 
##                              0                            934                            934 
##                           name                   activityType                  userProfileId 
##                            230                              0                              0 
##                     timeZoneId                 beginTimestamp                    eventTypeId 
##                              0                              0                              0 
##                           rule                      sportType                   startTimeGmt 
##                              0                           1263                              0 
##                 startTimeLocal                       duration                       distance 
##                              0                              0                              1 
##                       avgSpeed                          avgHr                          maxHr 
##                              2                            666                            665 
##                       avgPower                 avgBikeCadence                 maxBikeCadence 
##                           1842                           1198                           1198 
##                       calories          aerobicTrainingEffect                        strokes 
##                              2                           1521                           1207 
##                      normPower                 avgLeftBalance                avgRightBalance 
##                           1842                           2192                           2192 
##                  max20MinPower           avgFractionalCadence           maxFractionalCadence 
##                           1876                              0                              0 
##            trainingStressScore                intensityFactor                elapsedDuration 
##                           2177                           2177                           1191 
##                 movingDuration        anaerobicTrainingEffect                       deviceId 
##                           1551                           2350                            853 
##                 minTemperature                 maxTemperature                       lapCount 
##                           1288                           1288                           1644 
##   aerobicTrainingEffectMessage anaerobicTrainingEffectMessage                     purposeful 
##                           2835                           2835                              0 
##               autoCalcCalories                       favorite                             pr 
##                           1247                              0                              0 
##             elevationCorrected                    atpActivity                         parent 
##                            873                           1830                            476 
##                  elevationGain                  elevationLoss                       maxSpeed 
##                            175                            176                            494 
##                  maxRunCadence                          steps                 startLongitude 
##                           2834                           2834                            582 
##                  startLatitude         avgVerticalOscillation           avgGroundContactTime 
##                            582                           2835                           2835 
##                avgStrideLength                    vO2MaxValue               avgVerticalRatio 
##                           2834                           2608                           2835 
##        avgGroundContactBalance                   minElevation                   maxElevation 
##                           2835                           1019                           1019 
##               avgDoubleCadence               maxDoubleCadence                   locationName 
##                           2834                           2834                           1969 
##               maxVerticalSpeed                   endLongitude                    endLatitude 
##                           1710                           2420                           2420 
##                     avgStrokes                  activeLengths                       avgSwolf 
##                           2835                           2653                           2835 
##                     poolLength              avgStrokeDistance                 avgSwimCadence 
##                           2835                           2835                           2835 
##                 maxSwimCadence                      workoutId                     activeSets 
##                           2835                           2715                           2198 
##                      totalSets                      totalReps                       parentId 
##                           2198                           2198                           2822 
##                   manufacturer                       courseId                         maxFtp 
##                           2835                           2832                           2737 
##               avgVerticalSpeed                       decoDive            lactateThresholdBpm 
##                           2835                           2730                           2835 
##          lactateThresholdSpeed                     start_time                           date 
##                           2835                              0                              0 
##                        is_bike                         is_run               activity_recoded 
##                              0                              0                              0 
##                  qual_distance                     qual_avgHr 
##                              0                           1051</code></pre>
<p>For this use case, we will use a median imputation, because for some of the variables, the mean would not make sense (eg longitude and latitude).</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="multivar.html#cb228-1" aria-hidden="true" tabindex="-1"></a>dat_bike_imp <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat_bike,<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb228-2"><a href="multivar.html#cb228-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="cf">function</span>(xx) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(xx),<span class="fu">median</span>(xx,<span class="at">na.rm=</span>T),xx)))</span>
<span id="cb228-3"><a href="multivar.html#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(dat_bike_imp,<span class="cf">function</span>(xx) <span class="fu">sum</span>(<span class="fu">is.na</span>(xx)))</span></code></pre></div>
<pre><code>##                     activityId                        uuidMsb                        uuidLsb 
##                              0                            934                            934 
##                           name                   activityType                  userProfileId 
##                            230                              0                              0 
##                     timeZoneId                 beginTimestamp                    eventTypeId 
##                              0                              0                              0 
##                           rule                      sportType                   startTimeGmt 
##                              0                           1263                              0 
##                 startTimeLocal                       duration                       distance 
##                              0                              0                              0 
##                       avgSpeed                          avgHr                          maxHr 
##                              0                              0                              0 
##                       avgPower                 avgBikeCadence                 maxBikeCadence 
##                              0                              0                              0 
##                       calories          aerobicTrainingEffect                        strokes 
##                              0                              0                              0 
##                      normPower                 avgLeftBalance                avgRightBalance 
##                              0                              0                              0 
##                  max20MinPower           avgFractionalCadence           maxFractionalCadence 
##                              0                              0                              0 
##            trainingStressScore                intensityFactor                elapsedDuration 
##                              0                              0                              0 
##                 movingDuration        anaerobicTrainingEffect                       deviceId 
##                              0                              0                            853 
##                 minTemperature                 maxTemperature                       lapCount 
##                              0                              0                              0 
##   aerobicTrainingEffectMessage anaerobicTrainingEffectMessage                     purposeful 
##                           2835                           2835                              0 
##               autoCalcCalories                       favorite                             pr 
##                              0                              0                              0 
##             elevationCorrected                    atpActivity                         parent 
##                              0                              0                              0 
##                  elevationGain                  elevationLoss                       maxSpeed 
##                              0                              0                              0 
##                  maxRunCadence                          steps                 startLongitude 
##                              0                              0                              0 
##                  startLatitude         avgVerticalOscillation           avgGroundContactTime 
##                              0                           2835                           2835 
##                avgStrideLength                    vO2MaxValue               avgVerticalRatio 
##                           2834                              0                           2835 
##        avgGroundContactBalance                   minElevation                   maxElevation 
##                           2835                              0                              0 
##               avgDoubleCadence               maxDoubleCadence                   locationName 
##                              0                              0                           1969 
##               maxVerticalSpeed                   endLongitude                    endLatitude 
##                              0                              0                              0 
##                     avgStrokes                  activeLengths                       avgSwolf 
##                           2835                              0                           2835 
##                     poolLength              avgStrokeDistance                 avgSwimCadence 
##                           2835                           2835                           2835 
##                 maxSwimCadence                      workoutId                     activeSets 
##                           2835                           2715                              0 
##                      totalSets                      totalReps                       parentId 
##                              0                              0                           2822 
##                   manufacturer                       courseId                         maxFtp 
##                           2835                           2832                              0 
##               avgVerticalSpeed                       decoDive            lactateThresholdBpm 
##                           2835                              0                           2835 
##          lactateThresholdSpeed                     start_time                           date 
##                           2835                              0                              0 
##                        is_bike                         is_run               activity_recoded 
##                              0                              0                              0 
##                  qual_distance                     qual_avgHr 
##                              0                           1051</code></pre>
<p>Let’s do the same for categorical (maximum frequency), even though it is not mandatory for PCA. We first have to create a function that will return the most frequent category of a vector.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="multivar.html#cb230-1" aria-hidden="true" tabindex="-1"></a>most_freq_cat <span class="ot">&lt;-</span> <span class="cf">function</span>(xx)</span>
<span id="cb230-2"><a href="multivar.html#cb230-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb230-3"><a href="multivar.html#cb230-3" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">table</span>(xx)</span>
<span id="cb230-4"><a href="multivar.html#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">names</span>(tab[<span class="fu">which.max</span>(tab)]))</span>
<span id="cb230-5"><a href="multivar.html#cb230-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb230-6"><a href="multivar.html#cb230-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-7"><a href="multivar.html#cb230-7" aria-hidden="true" tabindex="-1"></a>dat_bike_imp <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat_bike_imp,<span class="fu">across</span>(<span class="fu">where</span>(is.character),</span>
<span id="cb230-8"><a href="multivar.html#cb230-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="cf">function</span>(xx) <span class="fu">coalesce</span>(xx,<span class="fu">most_freq_cat</span>(xx))))</span>
<span id="cb230-9"><a href="multivar.html#cb230-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-10"><a href="multivar.html#cb230-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(dat_bike_imp,<span class="cf">function</span>(xx) <span class="fu">sum</span>(<span class="fu">is.na</span>(xx)))</span></code></pre></div>
<pre><code>##                     activityId                        uuidMsb                        uuidLsb 
##                              0                              0                              0 
##                           name                   activityType                  userProfileId 
##                              0                              0                              0 
##                     timeZoneId                 beginTimestamp                    eventTypeId 
##                              0                              0                              0 
##                           rule                      sportType                   startTimeGmt 
##                              0                              0                              0 
##                 startTimeLocal                       duration                       distance 
##                              0                              0                              0 
##                       avgSpeed                          avgHr                          maxHr 
##                              0                              0                              0 
##                       avgPower                 avgBikeCadence                 maxBikeCadence 
##                              0                              0                              0 
##                       calories          aerobicTrainingEffect                        strokes 
##                              0                              0                              0 
##                      normPower                 avgLeftBalance                avgRightBalance 
##                              0                              0                              0 
##                  max20MinPower           avgFractionalCadence           maxFractionalCadence 
##                              0                              0                              0 
##            trainingStressScore                intensityFactor                elapsedDuration 
##                              0                              0                              0 
##                 movingDuration        anaerobicTrainingEffect                       deviceId 
##                              0                              0                              0 
##                 minTemperature                 maxTemperature                       lapCount 
##                              0                              0                              0 
##   aerobicTrainingEffectMessage anaerobicTrainingEffectMessage                     purposeful 
##                           2835                           2835                              0 
##               autoCalcCalories                       favorite                             pr 
##                              0                              0                              0 
##             elevationCorrected                    atpActivity                         parent 
##                              0                              0                              0 
##                  elevationGain                  elevationLoss                       maxSpeed 
##                              0                              0                              0 
##                  maxRunCadence                          steps                 startLongitude 
##                              0                              0                              0 
##                  startLatitude         avgVerticalOscillation           avgGroundContactTime 
##                              0                           2835                           2835 
##                avgStrideLength                    vO2MaxValue               avgVerticalRatio 
##                              0                              0                           2835 
##        avgGroundContactBalance                   minElevation                   maxElevation 
##                           2835                              0                              0 
##               avgDoubleCadence               maxDoubleCadence                   locationName 
##                              0                              0                              0 
##               maxVerticalSpeed                   endLongitude                    endLatitude 
##                              0                              0                              0 
##                     avgStrokes                  activeLengths                       avgSwolf 
##                           2835                              0                           2835 
##                     poolLength              avgStrokeDistance                 avgSwimCadence 
##                           2835                           2835                           2835 
##                 maxSwimCadence                      workoutId                     activeSets 
##                           2835                              0                              0 
##                      totalSets                      totalReps                       parentId 
##                              0                              0                              0 
##                   manufacturer                       courseId                         maxFtp 
##                           2835                              0                              0 
##               avgVerticalSpeed                       decoDive            lactateThresholdBpm 
##                           2835                              0                           2835 
##          lactateThresholdSpeed                     start_time                           date 
##                           2835                              0                              0 
##                        is_bike                         is_run               activity_recoded 
##                              0                              0                              0 
##                  qual_distance                     qual_avgHr 
##                              0                              0</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="multivar.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replacements &lt;-   select(dat_bike_imp,activityId,where(is.character)) %&gt;%</span></span>
<span id="cb232-2"><a href="multivar.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(-activityId,names_to=&quot;name&quot;,values_to=&quot;val&quot;) %&gt;% </span></span>
<span id="cb232-3"><a href="multivar.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(val)) %&gt;% </span></span>
<span id="cb232-4"><a href="multivar.html#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(name,val) %&gt;% </span></span>
<span id="cb232-5"><a href="multivar.html#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(cat_nb=n()) %&gt;% </span></span>
<span id="cb232-6"><a href="multivar.html#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(name,-cat_nb) %&gt;% </span></span>
<span id="cb232-7"><a href="multivar.html#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(name) %&gt;% </span></span>
<span id="cb232-8"><a href="multivar.html#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(most_freq=first(val)) %&gt;% </span></span>
<span id="cb232-9"><a href="multivar.html#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = name,values_from=most_freq) %&gt;% </span></span>
<span id="cb232-10"><a href="multivar.html#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename_with(function(xx) paste0(xx,&quot;_imp&quot;))</span></span></code></pre></div>
<p>Some of the variables contain only missing values (and cannot be imputed) <span class="math inline">\(\rightarrow\)</span> we drop them</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="multivar.html#cb233-1" aria-hidden="true" tabindex="-1"></a>missing <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">sapply</span>(dat_bike_imp,<span class="cf">function</span>(xx) <span class="fu">sum</span>(<span class="fu">is.na</span>(xx)))<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span>  <span class="fu">names</span>()</span>
<span id="cb233-2"><a href="multivar.html#cb233-2" aria-hidden="true" tabindex="-1"></a>dat_bike_imp <span class="ot">&lt;-</span> <span class="fu">select</span>(dat_bike_imp,<span class="sc">-</span>missing)</span></code></pre></div>
</div>
<div id="normalization" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Normalization</h3>
<p>Normalization is the operation consisting in scaling the columns so that their unit do not matter in the end. For example, the distance in meter is much larger than the cadence or the power, which have totally different units. To normalize the columns and make them unit-less, there are several methods among which the most common are the following :</p>
<ul>
<li>Standardization : <span class="math inline">\(X_i^{std} = \dfrac{X_i-\bar{X}}{\sigma_X} \rightarrow\)</span> mean 0 and standard deviation 1</li>
<li>Min-Max scaling : <span class="math inline">\(X_i^{std} = \dfrac{X_i-min(X)}{max(X)-min(X)} \rightarrow\)</span> between 0 and 1</li>
<li>Robust standardization <span class="math inline">\(X_i^{std} = \dfrac{X_i-Q2(X)}{Q3(X)-Q1(X)} \rightarrow\)</span> similar to the first option but robust to outliers</li>
</ul>
<p>You can check <a href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.preprocessing">scikit-learn’s documentation</a> to see what other options you have (and then search for their R implementation).</p>
<p>Normalization is a mandatory step before fitting a model, in order to avoid that only one feature bears the majority of the variance and makes the model biased.</p>
</div>
<div id="pca" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> PCA</h3>
<p>Principal Components Analysis (PCA) is often seen by machine learning engineers “only” as a dimension reduction technique, but it is also a very powerful tool to explore your data. PCA applies on numerical variables only, and aims to <strong>create new synthetic and uncorrelated variables : principal components</strong> (as a linear combination of the original variables) such that the <em>inertia</em> (ie variance) is highly concentrated on a small number of variables.</p>
<p>The mathematical problem is to find eigenvalues and eigenvectors of the correlation matrix. The eigenvectors represent the linear combination of the original variables needed to design those new variables, and the eigenvalues the variance that each of these new value bears. Once those new variables have been found, graphical representations within a few dimensions are possible.</p>
<p>To apply PCA, we will use the <code>FactoMineR</code> package, very easy to use for multivariate analysis.</p>
<p><strong>Notes</strong> :</p>
<ul>
<li>You can have supplementary continuous or categorical variables. They won’t be used in the construction of the eigenvectors, but you will be able to place them in the newly defined vector space.</li>
<li>By default, almost all implementations of PCA standardizes the data, so you do not have to do it by yourself, but check in the documentation of the function you use</li>
</ul>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="multivar.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;FactoMineR&quot;)</span></span>
<span id="cb234-2"><a href="multivar.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(FactoMineR)</span>
<span id="cb234-3"><a href="multivar.html#cb234-3" aria-hidden="true" tabindex="-1"></a>acp_dat <span class="ot">&lt;-</span> <span class="fu">select</span>(dat_bike_imp,deviceId,duration,distance,elevationGain,elevationLoss,avgSpeed,avgHr,calories,</span>
<span id="cb234-4"><a href="multivar.html#cb234-4" aria-hidden="true" tabindex="-1"></a>              minTemperature,maxTemperature,lapCount,avgBikeCadence,avgPower,vO2MaxValue,</span>
<span id="cb234-5"><a href="multivar.html#cb234-5" aria-hidden="true" tabindex="-1"></a>              max20MinPower) </span>
<span id="cb234-6"><a href="multivar.html#cb234-6" aria-hidden="true" tabindex="-1"></a>acp <span class="ot">&lt;-</span>   <span class="fu">PCA</span>(acp_dat,<span class="at">graph =</span> F,<span class="at">quali.sup =</span> <span class="fu">c</span>(<span class="dv">1</span>))</span></code></pre></div>
<p>What’s in this new object ?</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="multivar.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(acp)</span></code></pre></div>
<pre><code>## List of 6
##  $ eig      : num [1:14, 1:3] 4.49 2.01 1.67 1.36 1.25 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:14] &quot;comp 1&quot; &quot;comp 2&quot; &quot;comp 3&quot; &quot;comp 4&quot; ...
##   .. ..$ : chr [1:3] &quot;eigenvalue&quot; &quot;percentage of variance&quot; &quot;cumulative percentage of variance&quot;
##  $ var      :List of 4
##   ..$ coord  : num [1:14, 1:5] 0.781 0.897 0.503 0.498 0.643 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:14] &quot;duration&quot; &quot;distance&quot; &quot;elevationGain&quot; &quot;elevationLoss&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ cor    : num [1:14, 1:5] 0.781 0.897 0.503 0.498 0.643 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:14] &quot;duration&quot; &quot;distance&quot; &quot;elevationGain&quot; &quot;elevationLoss&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ cos2   : num [1:14, 1:5] 0.61 0.805 0.253 0.248 0.413 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:14] &quot;duration&quot; &quot;distance&quot; &quot;elevationGain&quot; &quot;elevationLoss&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ contrib: num [1:14, 1:5] 13.58 17.92 5.64 5.53 9.2 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:14] &quot;duration&quot; &quot;distance&quot; &quot;elevationGain&quot; &quot;elevationLoss&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##  $ ind      :List of 4
##   ..$ coord  : num [1:2835, 1:5] 2.388 -0.877 -1.489 1.153 1.503 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2835] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ cos2   : num [1:2835, 1:5] 0.148 0.157 0.125 0.201 0.267 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2835] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ contrib: num [1:2835, 1:5] 0.04478 0.00604 0.01741 0.01044 0.01774 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:2835] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ dist   : Named num [1:2835] 6.22 2.22 4.21 2.57 2.91 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:2835] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ svd      :List of 3
##   ..$ vs: num [1:14] 2.12 1.42 1.29 1.17 1.12 ...
##   ..$ U : num [1:2835, 1:5] 1.127 -0.414 -0.703 0.544 0.709 ...
##   ..$ V : num [1:14, 1:5] 0.369 0.423 0.238 0.235 0.303 ...
##  $ quali.sup:List of 5
##   ..$ coord : num [1:10, 1:5] 3.50332 0.58334 0.47068 -0.12367 0.00898 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:10] &quot;3355158044&quot; &quot;3454054575&quot; &quot;3825981698&quot; &quot;3842681113&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ cos2  : num [1:10, 1:5] 8.00e-01 1.25e-01 1.14e-01 9.20e-03 4.37e-05 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:10] &quot;3355158044&quot; &quot;3454054575&quot; &quot;3825981698&quot; &quot;3842681113&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ v.test: num [1:10, 1:5] 10.65797 0.38925 4.32709 -0.13055 0.00734 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:10] &quot;3355158044&quot; &quot;3454054575&quot; &quot;3825981698&quot; &quot;3842681113&quot; ...
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##   ..$ dist  : Named num [1:10] 3.92 1.65 1.4 1.29 1.36 ...
##   .. ..- attr(*, &quot;names&quot;)= chr [1:10] &quot;3355158044&quot; &quot;3454054575&quot; &quot;3825981698&quot; &quot;3842681113&quot; ...
##   ..$ eta2  : num [1, 1:5] 0.1774 0.0959 0.0819 0.2092 0.0293
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr &quot;deviceId&quot;
##   .. .. ..$ : chr [1:5] &quot;Dim.1&quot; &quot;Dim.2&quot; &quot;Dim.3&quot; &quot;Dim.4&quot; ...
##  $ call     :List of 10
##   ..$ row.w     : num [1:2835] 0.000353 0.000353 0.000353 0.000353 0.000353 ...
##   ..$ col.w     : num [1:14] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ scale.unit: logi TRUE
##   ..$ ncp       : num 5
##   ..$ centre    : num [1:14] 77.4 31.4 376.1 325.7 22 ...
##   ..$ ecart.type: num [1:14] 57.6 34.3 1079.8 1059.3 12.4 ...
##   ..$ X         :&#39;data.frame&#39;:   2835 obs. of  15 variables:
##   .. ..$ deviceId      : Factor w/ 10 levels &quot;3355158044&quot;,&quot;3454054575&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ duration      : num [1:2835] 37.9 28.4 10.4 65.9 71.5 ...
##   .. ..$ distance      : num [1:2835] 27.71 16.4 6.24 49.27 52.1 ...
##   .. ..$ elevationGain : num [1:2835] 325 76 38 266 266 ...
##   .. ..$ elevationLoss : num [1:2835] 0 0 0 0 0 0 0 0 0 0 ...
##   .. ..$ avgSpeed      : num [1:2835] 43.9 34.6 36.1 44.9 43.7 ...
##   .. ..$ avgHr         : int [1:2835] 168 135 138 130 158 149 141 149 152 149 ...
##   .. ..$ calories      : num [1:2835] 742 392 110 1025 1124 ...
##   .. ..$ minTemperature: int [1:2835] 18 18 18 18 18 18 18 18 18 18 ...
##   .. ..$ maxTemperature: int [1:2835] 27 27 27 27 27 27 27 27 27 27 ...
##   .. ..$ lapCount      : int [1:2835] 1 1 1 1 1 1 1 1 1 1 ...
##   .. ..$ avgBikeCadence: int [1:2835] 86 83 78 84 88 85 74 69 88 86 ...
##   .. ..$ avgPower      : int [1:2835] 333 240 186 266 270 241 239 280 270 228 ...
##   .. ..$ vO2MaxValue   : int [1:2835] 65 65 65 65 65 65 65 65 65 65 ...
##   .. ..$ max20MinPower : num [1:2835] 342 252 278 292 299 ...
##   ..$ row.w.init: num [1:2835] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ call      : language PCA(X = acp_dat, quali.sup = c(1), graph = F)
##   ..$ quali.sup :List of 5
##   .. ..$ quali.sup :&#39;data.frame&#39;:    2835 obs. of  1 variable:
##   .. .. ..$ deviceId: Factor w/ 10 levels &quot;3355158044&quot;,&quot;3454054575&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##   .. ..$ modalite  : int 10
##   .. ..$ nombre    : num [1:10] 41 2 335 5 3 90 15 309 1550 485
##   .. ..$ barycentre:&#39;data.frame&#39;:    10 obs. of  14 variables:
##   .. .. ..$ duration      : num [1:10] 145.5 96.9 61.9 65.9 110.1 ...
##   .. .. ..$ distance      : num [1:10] 77.2 42.4 37 34.3 30.5 ...
##   .. .. ..$ elevationGain : num [1:10] 700 298 367 250 490 ...
##   .. .. ..$ elevationLoss : num [1:10] 706 271 0 261 468 ...
##   .. .. ..$ avgSpeed      : num [1:10] 31.92 25.22 35.89 28.42 9.52 ...
##   .. .. ..$ avgHr         : num [1:10] 139 145 140 125 134 ...
##   .. .. ..$ calories      : num [1:10] 2238 1894 907 593 1018 ...
##   .. .. ..$ minTemperature: num [1:10] 15.2 18 18 18 18 ...
##   .. .. ..$ maxTemperature: num [1:10] 23.5 27 27 27 27 ...
##   .. .. ..$ lapCount      : num [1:10] 17.71 3 6.97 3 3 ...
##   .. .. ..$ avgBikeCadence: num [1:10] 85.2 95.5 86.4 84.6 85.3 ...
##   .. .. ..$ avgPower      : num [1:10] 257 243 251 243 243 ...
##   .. .. ..$ vO2MaxValue   : num [1:10] 68.6 65 65 65 65 ...
##   .. .. ..$ max20MinPower : num [1:10] 309 278 281 278 278 ...
##   .. ..$ numero    : num 1
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;PCA&quot; &quot;list&quot;</code></pre>
<p>This is a list with several elements :</p>
<ul>
<li><code>eig</code> contains the eigenvalues, and their share in the total inertia (PCA is performed by default on scaled variables <span class="math inline">\(\rightarrow\)</span> the trace of the diagonal matrix equals to the number of columns)</li>
<li><code>ind</code> and <code>var</code> refer to rows and columns. They both have the same elements : “coord” for the coordinates on each principal component, “contr” the contributions to the inertia of this row (resp column) to the inertia of the component, “cos2” the squared cosine (ie quality of projection) for the row/column</li>
<li><code>quali.sup</code> have the same elements than the previous ones (coordinates are the barycenter of each category of the qualitative variable) plus the <span class="math inline">\(\eta^2\)</span> statistic.</li>
</ul>
<p>The first thing is to have a look at the eignevalues to see how well the PCA could summarize the information</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="multivar.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(acp<span class="sc">$</span>eig[,<span class="dv">2</span>])</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="multivar.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(acp<span class="sc">$</span>eig[,<span class="dv">3</span>])</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-89-2.png" width="672" /></p>
<p>In our case, the first component bears 35% of the total inertia and the second 15%. Hence, the first factorial plane (the first 2 components) : let’s look at how the variable correlate with them :</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="multivar.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.PCA</span>(acp,<span class="at">choix=</span><span class="st">&quot;var&quot;</span>,<span class="at">col.var =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<p>What you can read at once on this plot is how important each variable is to construct the new variables. As a matter of fact, contribution, cos2 and coordinates are almost the same in PCA, meaning that the closer to the unit disc the coordinate is, the higher both contribution and quality of representation.</p>
<p>What we deduct from this graph :</p>
<ul>
<li>Distance, calories and duration have the largest values on the first component <span class="math inline">\(\rightarrow\)</span> they contribute largely to the first component, which bears the 35% of total variance <span class="math inline">\(\rightarrow\)</span> those variables are the most discriminant</li>
<li>Those three variables are very close to each other, which means they are highly correlated</li>
<li>The average cadence is on the other side of the first component <span class="math inline">\(\rightarrow\)</span> it is negatively correlated with those variables</li>
<li>There is a right angle between elevationGain and avgPower <span class="math inline">\(\rightarrow\)</span> the correlation is very small</li>
</ul>
<p>Let’s check the correlation matrix to be sure about what we are reading here</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="multivar.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(acp_dat,<span class="sc">-</span>deviceId) <span class="sc">%&gt;%</span> </span>
<span id="cb240-2"><a href="multivar.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggcorr</span>()</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p>How about the individuals ?</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="multivar.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.PCA</span>(acp,<span class="at">choix=</span><span class="st">&quot;ind&quot;</span>)</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p>This graph is harder to read, but we still can identify outliers and understand what they are. Anyway in the top-right corner, those are long rides with a lot of ups and downs ! The most extreme is 742999663 which is another measurement error (indoor cycling with 34000 elevation meters !)</p>
</div>
<div id="exercises-2" class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Exercises</h3>
<ul>
<li>Remove the measurement errors and re-run the PCA ; what are the changes ?</li>
<li>Let’s focus the running activities : select relevant features, impute the missing values using k-nn, run a PCA and analyze the results</li>
</ul>
</div>
</div>
<div id="dimension-reduction" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Dimension reduction</h2>
<p>Dimension reduction aims to reduce the size of the data ; most of the time the goal is to decrease the number of columns but it can also apply to rows (depending on your use case). Why reduce the dimension :</p>
<ul>
<li>Avoid the <a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">curse of dimensionality</a></li>
<li>Remove undesired noise</li>
<li>Avoid <a href="https://en.wikipedia.org/wiki/Multicollinearity">multicollinearity</a> in the features</li>
</ul>
<p>Dimension reduction is, after normalization, a very common step to take prior training a machine learning algorithm.</p>
<div id="use-the-results-of-the-pca" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Use the results of the PCA</h3>
<p>After performing a PCA, you can select a limited number of principal components that you will use further in the modeling task. You can chose the number of components to keep with several criteria :</p>
<ul>
<li>average inertia (eigenvalue &gt; 1)</li>
<li>minimal total inertia (eg 80%)</li>
<li>elbow criteria : keep components before there is a “drop” in the eigenvalues barplot</li>
</ul>
</div>
<div id="other-inertia-based-methods" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Other inertia-based methods</h3>
<p>PCA is designed only for continuous variables, but you can use other methods for other types of data :</p>
<ul>
<li>MCA (Multiple Correspondence Analysis ) for categorical variables (if you have a mixture of continuous and categorical, you can discretize numerical variables and perform MCA)</li>
<li>FDA (Functional Data Analysis for functions/curves)</li>
</ul>
</div>
<div id="t-sne" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> t-SNE</h3>
<div id="algorithm-description" class="section level4" number="6.3.3.1">
<h4><span class="header-section-number">6.3.3.1</span> Algorithm description</h4>
<p>t-SNE has a completely different approach to dimension reduction : it does not aim to preserve the total variance, but rather the proximity between the observations.</p>
<p>The algorithm has 3 steps :</p>
<ul>
<li>Compute the similarity between each pair of points using a gaussian distribution (instead of a raw euclidean distance) <span class="math inline">\(\Rightarrow\)</span> n collections (distributions) of similarity scores in the high-dimensional space</li>
<li>Initiate a low-dimensional space and map all high-dimensional points on it. Compute the same pairwise similarities with Student distribution (hence the t in t-SNE) in this space <span class="math inline">\(\Rightarrow\)</span> n collections (distributions) of similarity scores in the low-dimensional space</li>
<li>Gradually move the points in the low-dimensional space so that the sum of divergences between pairwise similarities in both spaces are minimal. The divergence is the <a href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence">Kullback-Leibler</a> divergence between the 2 distributions of similarity scores</li>
</ul>
<p>You can watch this very well done <a href="https://www.youtube.com/watch?v=NEaUSP4YerM">video</a> to understand how the algorithm precisely works</p>
<p>How this similarity scores are computed.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="multivar.html#cb242-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xx=</span><span class="fu">rnorm</span>(<span class="dv">100</span>),<span class="at">yy=</span><span class="fu">rnorm</span>(<span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb242-2"><a href="multivar.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col=</span><span class="fu">ifelse</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;black&quot;</span>))</span>
<span id="cb242-3"><a href="multivar.html#cb242-3" aria-hidden="true" tabindex="-1"></a>dd <span class="sc">%&gt;%</span>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(xx,yy,<span class="at">color=</span>col)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb242-4"><a href="multivar.html#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span>F) <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="multivar.html#cb243-1" aria-hidden="true" tabindex="-1"></a>dd <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">xx_ref=</span>dd<span class="sc">$</span>xx[<span class="dv">1</span>],<span class="at">yy_ref=</span>dd<span class="sc">$</span>yy[<span class="dv">1</span>],</span>
<span id="cb243-2"><a href="multivar.html#cb243-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">euclid =</span> (yy_ref<span class="sc">-</span>yy)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (yy_ref<span class="sc">-</span>yy)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb243-3"><a href="multivar.html#cb243-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">simil =</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">dnorm</span>(euclid)) <span class="sc">%&gt;%</span> </span>
<span id="cb243-4"><a href="multivar.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(euclid,simil)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb243-5"><a href="multivar.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distance and similarity to the first point&quot;</span>)</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-93-2.png" width="672" /></p>
<p>Pros and cons compared to PCA :</p>
<ul>
<li>Preserves non-linear relationships and is robust to outliers</li>
<li>Much more computationally costly</li>
<li>Starts with a PCA</li>
</ul>
</div>
<div id="implementation-in-r-1" class="section level4" number="6.3.3.2">
<h4><span class="header-section-number">6.3.3.2</span> Implementation in R</h4>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="multivar.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;Rtsne&quot;)</span></span>
<span id="cb244-2"><a href="multivar.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(Rtsne)</span>
<span id="cb244-3"><a href="multivar.html#cb244-3" aria-hidden="true" tabindex="-1"></a>tsne <span class="ot">&lt;-</span> <span class="fu">select</span>(dat_bike_imp,<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span>  </span>
<span id="cb244-4"><a href="multivar.html#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Rtsne</span>(<span class="at">dims=</span><span class="dv">2</span>,<span class="at">max_iter=</span><span class="dv">500</span>,<span class="at">check_duplicates =</span> F)</span>
<span id="cb244-5"><a href="multivar.html#cb244-5" aria-hidden="true" tabindex="-1"></a>tsne<span class="sc">$</span>Y <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb244-6"><a href="multivar.html#cb244-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(V1,V2)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb244-7"><a href="multivar.html#cb244-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Low dimensional representation by t-SNE&quot;</span>)</span></code></pre></div>
<p><img src="DataExploration_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>You can check this other extensive <a href="https://www.analyticsvidhya.com/blog/2017/01/t-sne-implementation-r-python/">blogpost</a> with use cases and also python implementation.</p>
</div>
</div>
<div id="a-word-about-clustering" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> A word about clustering</h3>
<p>Clustering (or unsupervised machine learning) can also be considered as a dimension reduction technique, but which you operate on the observation rather than on the features. The aim of clustering techniques are to gather observations in homogeneous groups (wrt the features you observed).
It can also be very effective to analyze and understand your data to check the characteristics of the sub-groups ; it can also be very insightful for business teams to have such “categories” they can relate with.</p>
</div>
<div id="exercise-1" class="section level3" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Exercise</h3>
<ul>
<li>Interpret the results of the T-SNE embedding</li>
</ul>
</div>
</div>
<div id="visualization-bonus-dashboards-and-reports" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Visualization bonus : dashboards and reports</h2>
<div id="shiny-and-rmarkdown" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Shiny and rmarkdown</h3>
<p>R offers 2 main packages that allow you to create dashboards and reports in HTML format and the latest feature of web technologies without knowing anything about HTML, CSS or other web-specific languages :</p>
<ul>
<li><a href="https://rmarkdown.rstudio.com/">Rmarkdown</a> is markdown adapted to R, allows you to create <em>standalone</em> documents in either PDF or HTML format, and mixes regular word-processor features and R code. The <a href="https://rmarkdown.rstudio.com/flexdashboard/">flexdashboard package</a> is an extension to Rmarkdown that helps to generate dashboards in HTML format. Those tools are essentially used to design reproducible documents (scientific reports, regularly updated reports/dashboards…). You can also create presentation with it.</li>
<li><a href="https://shiny.rstudio.com/gallery/">Shiny</a> is a package to develop interactive web-apps. A shiny app requires an R engine to be rendered on the client side.</li>
</ul>
<p>In the course material, you’ll find one example for each package. You’ll easily find online material to develop your skills further with these tools</p>
<ul>
<li>For <a href="https://bookdown.org/yihui/rmarkdown/">rmarkdown</a></li>
<li>For <a href="https://mastering-shiny.org/">shiny</a></li>
</ul>
</div>
<div id="web-based-graphics-with-plotly" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Web-based graphics with <code>plotly</code></h3>
<p><a href="https://plotly.com/r/">plotly</a> is a graphical library that generate “interactive” web-based graphics. It is available for R, but also python and other programming languages. You can learn the syntax of this package too, but there is a very useful function, <code>plotly::ggplotly()</code> that translates your ggplot object into a <code>plotly</code> graphic. It works for most of the cases.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="multivar.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;plotly&quot;)</span></span>
<span id="cb245-2"><a href="multivar.html#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(plotly)</span>
<span id="cb245-3"><a href="multivar.html#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotly(gg1)</span></span></code></pre></div>
<p>This is very useful to embed in a rmarkdown document or a shiny app !</p>
</div>
<div id="other-packages-widgets" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Other packages &amp; widgets</h3>
<p>You can use a lot of other <a href="https://www.htmlwidgets.org/index.html">html widgets</a> to incorporate in your report/shiny app</p>
<p>Example of leaflet :</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="multivar.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(dat,is_bike) %&gt;%</span></span>
<span id="cb246-2"><a href="multivar.html#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaflet::leaflet(data=.) %&gt;%</span></span>
<span id="cb246-3"><a href="multivar.html#cb246-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaflet::addMarkers(lng = ~startLongitude,lat = ~startLatitude,</span></span>
<span id="cb246-4"><a href="multivar.html#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                              popup = ~activityId) %&gt;%</span></span>
<span id="cb246-5"><a href="multivar.html#cb246-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaflet::addTiles()</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="stats.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reg.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DataExploration.pdf", "DataExploration.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
